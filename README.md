# Architecture

## Environment tool
- CI/CD: Jenkins 
- Containerization: Docker
- Container Orchestration: Minikube
- Version control: github
- K8s managed: helm

## Setup local enviroment
Refer to Infra repo:
https://github.com/anle20/Infra-elsa

## Deploy Hackathon-app from local
Using deploy.sh to deploy
```bash
cd ./script
./deploy.sh
```

1. We will need to deploy MongoDB first
2. After that, using helm to deploy application
3. Now open the browser and enter hackathon-elsa.example

## Deploy Hackathon-app through CICD
We use Jenkins operator (master-slave) which is deployed on K8s. Refer to below diagram

![cicd](https://github.com/user-attachments/assets/f7ba7def-013c-4727-910b-8b913d368b08)


1. We will need to deploy MongoDB manually first
kubectl apply -f ../deployment/db/mongodb-deployment.yaml

2. Trigger hackathon pipeline on jenkins
<img width="1070" alt="Screenshot 2024-09-16 at 21 15 30" src="https://github.com/user-attachments/assets/4a505f5e-6f9d-4bc0-823c-59855f90750e">
<img width="1298" alt="Screenshot 2024-09-16 at 21 15 45" src="https://github.com/user-attachments/assets/549817d4-8305-45c2-aa0b-e1ecf253e8eb">


## Monitoring:
We can use Prometheus and Grafana to monitor metrics

- Prometheus: a powerful open-source monitoring and alerting toolkit designed for cloud-native environments like Kubernetes. It scrapes metrics from various targets, stores them in a time-series database, and provides a querying language (PromQL) to analyze the data.
We can use Prometheus operator to deploy on EKS.

- Grafana: connects to Prometheus as a data source and provides an interactive dashboard to visualize metrics

- Node Exporter: Installed on the EC2 instances that form the EKS worker nodes. It exposes hardware and OS-level metrics such as CPU, memory, disk usage, and network bandwidth.

- cAdvisor (Container Advisor): Integrated with Kubernetes and responsible for exposing resource usage and performance metrics for each container running in pods.

- Kube-state-metrics: Collects metrics about the state of Kubernetes resources (Deployments, StatefulSets, DaemonSets, etc.), giving insights into the operational state of the cluster.

- Alertmanager is responsible for handling alerts generated by Prometheus. Alerts can be configured based on thresholds (e.g., CPU usage exceeding 80% for a pod) and can notify you via email, Slack, or other channels.

![monitoring drawio](https://github.com/user-attachments/assets/57e3910b-d36c-49a4-8771-10a0b5008c17)



## Logging:
We can use EFK(Elastic search - Fluentbit - Kibana) stack to collect the log and visualization
- Elasticsearch is deployed as statefulset as it stores the log data. Besides that, we can use OpenSearch AWS as well.
- Kibana is deployed as deployment and connects to elasticsearch service endpoint.
- Fluent-bit is deployed as a daemonset to gather the container logs from every node. It connects to the Elasticsearch service endpoint to forward the logs.

![image](https://github.com/user-attachments/assets/7fb6023d-b6b7-41c1-8068-8b8fc6c106d1)


## Cloud Architecture

Architecture Components:
- Amazon ECR (Elastic Container Registry): Stores and manages container images used by Amazon EKS clusters.
- Amazon EKS Cluster: A managed Kubernetes cluster that runs containerized applications.
- Internet Gateway: Allows traffic to flow between the EKS cluster and the internet.
- Load Balancer (Service in Kubernetes): Distributes traffic across multiple instances of a containerized application.
- Auto-Scaling: Automatically scales the number of instances of a containerized application based on demand
- Availability Zones: Physically separate data centers that provide redundancy and fault tolerance.
- Public Subnets: Subnets that allow communication with the internet.
- Private Subnets: Subnets that do not allow communication with the internet
- DocumentDB: Store data (replace to MongoDB)

![cloud drawio](https://github.com/user-attachments/assets/7951914c-5a8c-4f58-a9e6-0d9d849d49ea)
















